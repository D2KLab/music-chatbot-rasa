# Documentation
This repositry is dedicated for the all the scripts and files needed to train, run, and evaluate the DOREMUS bot.
## Requirements:
- RASA NLU: 0.12.3
- spacy
- parsedatetime
- date_extractor

## Transforming Dialogflow training data into RASA
- Keep the dialogflow export in the `DOREMUS/dialogflow` folder.

-  `python domain_builder.py`

This creates the domain file in data folder.

-  `python story_builder.py`

This creates the stories file in the data folder.

-  `python action_builder.py`

This creates the custom action classes in the `Action.py` script.

## Steps for training:

### Training the NLU model:
#### Easy method
You should have training data inside the `DOREMUS/data` folder in the form of a json file and the pipeline configuration file inside the DOREMUS directory. After the NLU training data is ready, you can run the command below: 
- `python driver.py train-nlu`

#### Another method 
If you want to place your training data in an another location you can use the following command to train the NLU model:

- `python -m rasa_nlu.train -c path_to_config_file/nlu_config.yml --data path_to_nlu_training_data/nlu.md -o wanted_output_path --fixed_model_name nlu --project current --verbose`

### Training the dialogue model:

#### Easy Method
The domain file and the stories should be present inside the data folder. After your training data is ready run the the command below to train the dialogue model. 
- `python driver.py train-dialogue-init`


#### Another Method
If you want to place your training data in an arbitrary location you can use the following command to train the dialogue model: 
- `python -m rasa_core.train -d path_to_domain_file/domain.yml -s path_to_stories_file/stories.md -o models/dialogue`

## Running the bot in the command line
### Easy method
If the trained models are saved in their default locations then simply run the following command: 
- `python driver.py run`

### Another Method
If the models are saved in another location then the above command will not work, but you can run the bot by:
- `python -m rasa_core.run -d path_to_dialogue_model -u path_nlu_model` 

### Debug mode 
To run the bot in debug mode:
- `python -m rasa_core.run -d models_to_dialogue -u path_to_nlu_model --debug`

### HTTP Server
To run the bot as an HTTP server:
- `python -m rasa_core.server -d models_to_dialogue/dialogue -u path_to_dialogue_model` 

To Send requests to the server:
- `curl -XPOST localhost:5005/conversations/default/respond -d '{"query":"hello there"}'`

## Evaluating the models:
### NLU Model
- `nlu_validation.md` is a markdown file used for evaluating the NLU model.
 #### To run evaluation script:
 - `python -m rasa_nlu.evaluate --data path_to_validation_data --model path_to_nlu`
- Alternatively you can run the jupyter notebook [`generating_validation_data.ipynb`](https://github.com/boukhary123/DOREMUS/blob/master/DOREMUS/generating_validation_data.ipynb) which contains a small script that generates some validation data from history logs and evaluates the model. But note that the evaluation data generated by the script will only contain intents, adding entities can be done manually.
### Evaluating the dialogue model
- `stories_evaluation.md` contain some stories for evaluating the dialogue model.
#### To run the Evaluation script
- `python -m rasa_core.evaluate --core path_to_dialogue --stories path_to_stories -o results`
- Another option is running it from the jupyter notebook mentioned above.

## Adding New Intents
- To add new intents and/or entities you will need to create some training examples inside the data/training_data.json file and add the new intents/entities inside the data/domain folder.

## Adding New Actions
- To add new action you should add the new action to the domain file and add some example stories inside the stories file. And add an action class inside the action.py script file.

## Comparing RASA to Dialogflow 
- This [notebook](https://github.com/boukhary123/DOREMUS/blob/master/DOREMUS/compare_results/Collecting_data.ipynb) in the `compare_results`directory contains the script necessary to collect the data used for comparison and the script that uses this data for comparison.

## References
- [Rasa Docs](https://rasa.com/docs/)
- [https://github.com/Priprocks/Dialogflow_export_to_rasa](https://github.com/Priprocks/Dialogflow_export_to_rasa)